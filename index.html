<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-DocuQuest | Bukal INHS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden-section { display: none; }
    .nav-btn { transition: all 0.2s; border-bottom: 2px solid transparent; }
    .nav-btn:hover { color: #064e3b; border-color: #064e3b; }
    .active-nav { color: #064e3b; border-color: #064e3b; font-weight: bold; }
    
    /* Background & Floating Leaves */
    body { 
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); 
      overflow-x: hidden;
      position: relative;
    }

    .leaf-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; 
      z-index: 0;
    }

    /* Subtle leaf design */
    .leaf {
      position: absolute;
      display: block;
      width: 15px;
      height: 15px;
      background: #13633d;
      opacity: 0.1;
      border-radius: 0 100% 0 100%;
      animation: float 15s infinite linear;
    }

    @keyframes float {
      0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 0; }
      10% { opacity: 0.15; }
      90% { opacity: 0.15; }
      100% { transform: translateY(110vh) translateX(100px) rotate(360deg); opacity: 0; }
    }

    .leaf:nth-child(1) { left: 10%; animation-duration: 18s; animation-delay: 0s; }
    .leaf:nth-child(2) { left: 35%; animation-duration: 22s; animation-delay: -5s; }
    .leaf:nth-child(3) { left: 60%; animation-duration: 15s; animation-delay: -2s; }
    .leaf:nth-child(4) { left: 85%; animation-duration: 25s; animation-delay: -8s; }

    .content-wrapper { position: relative; z-index: 10; }
    .bg-bnhs-green { background-color: #13633d; }
    .text-bnhs-green { color: #13633d; }
    .border-bnhs-green { border-color: #13633d; }
  </style>
</head>
<body class="font-sans text-gray-800 min-h-screen">

  <div class="leaf-container">
    <div class="leaf"></div>
    <div class="leaf"></div>
    <div class="leaf"></div>
    <div class="leaf"></div>
  </div>

  <div class="content-wrapper">
    <nav class="bg-white/90 backdrop-blur-md shadow-sm p-4 flex justify-center gap-8 sticky top-0 z-50">
      <button onclick="showSection('request')" id="btn-request" class="nav-btn py-1 active-nav">Request</button>
      <button onclick="showSection('track')" id="btn-track" class="nav-btn py-1">Track Progress</button>
      <button onclick="showSection('admin-login')" id="btn-admin" class="text-gray-400 text-[10px] mt-1 hover:text-gray-600 transition uppercase tracking-widest">Admin Access</button>
    </nav>

    <section id="request" class="max-w-2xl mx-auto py-12 px-4">
      <div class="bg-white/95 rounded-3xl shadow-xl p-8 border-t-8 border-bnhs-green backdrop-blur-sm">
        <div class="text-center mb-8">
          <img src="school-logo.jfif" alt="Bukal INHS Logo" class="mx-auto w-32 h-32 mb-4 object-contain">
          <h1 class="text-3xl font-black text-gray-900 tracking-tight">E-DocuQuest</h1>
          <p class="text-bnhs-green font-bold uppercase tracking-wider text-sm">Bukal Integrated National High School</p>
          <p class="text-gray-500 text-[10px] mt-1 uppercase tracking-widest font-semibold">Padre Garcia, Batangas â€¢ Est. 1981</p>
        </div>
        
        <form id="requestForm" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input id="name" type="text" placeholder="Full Name" class="w-full p-4 bg-gray-50 rounded-xl border focus:ring-2 focus:ring-emerald-400 outline-none transition" required>
            <input id="email" type="email" placeholder="Email Address" class="w-full p-4 bg-gray-50 rounded-xl border focus:ring-2 focus:ring-emerald-400 outline-none transition" required>
          </div>
          <input id="contact" type="text" placeholder="Contact Number (09...)" class="w-full p-4 bg-gray-50 rounded-xl border focus:ring-2 focus:ring-emerald-400 outline-none transition">
          <select id="document" class="w-full p-4 bg-gray-50 rounded-xl border focus:ring-2 focus:ring-emerald-400 outline-none transition" required>
            <option value="">Select Document...</option>
            <option>Form 137 (Permanent Record)</option>
            <option>Form 138 (Report Card)</option>
            <option>Certificate of Good Moral</option>
            <option>Certificate of Graduation</option>
            <option>Request / Transfer Letter</option>
          </select>
          <textarea id="reason" placeholder="Reason for Request" class="w-full p-4 bg-gray-50 rounded-xl border focus:ring-2 focus:ring-emerald-400 outline-none transition" rows="3" required></textarea>
          <button type="submit" id="submitBtn" class="w-full bg-bnhs-green text-white py-4 rounded-xl font-bold text-lg hover:brightness-110 shadow-lg active:scale-95 transition-all">Submit Request</button>
        </form>
        <div id="requestFeedback" class="mt-6"></div>
      </div>
    </section>

    <section id="track" class="hidden-section max-w-xl mx-auto py-12 px-4">
      <div class="bg-white/95 rounded-3xl shadow-xl p-8 text-center backdrop-blur-sm">
        <h2 class="text-2xl font-bold mb-2">Track Your Document</h2>
        <p class="text-gray-500 mb-6 italic text-sm">Enter your Tracking ID below</p>
        
        <input id="trackId" type="text" placeholder="BNHS-XXXXX" class="w-full p-4 bg-gray-50 rounded-xl border mb-4 text-center font-mono text-xl uppercase tracking-widest outline-none focus:border-bnhs-green transition">
        <button onclick="handleTrack()" id="trackBtn" class="w-full bg-bnhs-green text-white py-4 rounded-xl font-bold hover:brightness-110 shadow-md transition">Check Status</button>
        
        <div id="trackDisplay" class="hidden-section mt-10 p-6 bg-emerald-50 rounded-2xl border border-emerald-100">
          <p id="trackHeaderMessage" class="text-sm font-bold text-emerald-900 mb-4 px-2 leading-tight"></p>
          <div class="w-full bg-gray-200 rounded-full h-4 mb-6 overflow-hidden">
            <div id="trackBar" class="bg-bnhs-green h-full transition-all duration-1000" style="width: 0%"></div>
          </div>
          <p class="text-gray-500 text-[10px] uppercase tracking-widest mb-1 font-bold">Current Phase</p>
          <p id="trackStatusText" class="text-2xl font-black text-bnhs-green italic uppercase tracking-tighter"></p>
        </div>
      </div>
    </section>

    <section id="admin-login" class="hidden-section max-w-sm mx-auto py-12 px-4">
      <div class="bg-white p-8 rounded-2xl shadow-lg border">
        <h2 class="text-xl font-bold mb-4 text-center">Admin Access</h2>
        <input id="adminEmail" type="email" placeholder="Email" class="w-full p-3 border rounded-lg mb-3 outline-none focus:border-bnhs-green">
        <input id="adminPass" type="password" placeholder="Password" class="w-full p-3 border rounded-lg mb-4 outline-none focus:border-bnhs-green">
        <button onclick="handleAdminLogin()" id="loginBtn" class="w-full bg-gray-800 text-white py-3 rounded-lg font-bold hover:bg-black transition">Verify</button>
      </div>
    </section>

    <section id="admin-panel" class="hidden-section max-w-6xl mx-auto py-12 px-4">
      <div class="bg-white p-6 rounded-2xl shadow-2xl overflow-hidden">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
          <h2 class="text-2xl font-bold text-gray-800">Request Dashboard</h2>
          <button onclick="loadAdminData()" class="bg-emerald-100 text-emerald-700 p-2 px-4 rounded-lg font-bold hover:bg-emerald-200 transition">ðŸ”„ Refresh List</button>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="bg-bnhs-green text-white font-bold">
                <th class="p-4 rounded-tl-lg">ID</th>
                <th class="p-4">Student</th>
                <th class="p-4">Document</th>
                <th class="p-4 text-center">Status</th>
                <th class="p-4 rounded-tr-lg text-center">Update</th>
              </tr>
            </thead>
            <tbody id="adminTableBody" class="text-sm"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzNq_pNzkjqME0-myMHUh2ixiOxhdbrzGXiaUCo-REr-jjhcYOf1XCvpr4ey6z2P_mQ/exec"; 

    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.add('hidden-section'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-nav'));
      document.getElementById(id).classList.remove('hidden-section');
      const navBtn = document.getElementById('btn-' + id);
      if(navBtn) navBtn.classList.add('active-nav');
    }

    // FORM SUBMISSION
    document.getElementById('requestForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const feedback = document.getElementById('requestFeedback');
      btn.disabled = true;
      btn.innerText = "Processing Request...";
      const trackingId = "BNHS-" + Math.floor(10000 + Math.random() * 90000);
      const payload = {
        action: "submit",
        trackingId: trackingId,
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        contact: document.getElementById('contact').value,
        document: document.getElementById('document').value,
        reason: document.getElementById('reason').value
      };
      try {
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
        feedback.innerHTML = `
          <div class="bg-bnhs-green p-6 rounded-2xl text-white text-center shadow-lg border-2 border-white/20">
            <p class="font-bold text-sm uppercase opacity-80 mb-1">Success! Your Tracking ID is:</p>
            <p class="text-4xl font-mono font-black my-2 tracking-widest">${trackingId}</p>
            <p class="text-[10px] italic">Please save this ID to check your progress.</p>
          </div>`;
        document.getElementById('requestForm').reset();
      } catch (err) { alert("System connection error."); }
      btn.disabled = false; btn.innerText = "Submit Request";
    });

    // TRACKING LOGIC
    async function handleTrack() {
      const id = document.getElementById('trackId').value.trim().toUpperCase();
      if(!id) return;
      const btn = document.getElementById('trackBtn');
      btn.innerText = "Finding Record...";
      try {
        const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "track", trackingId: id}) });
        const data = await res.json();
        if (data.status === "Not Found") { alert("Tracking ID not found."); btn.innerText = "Check Status"; return; }
        
        document.getElementById('trackDisplay').classList.remove('hidden-section');
        document.getElementById('trackStatusText').innerText = data.status;
        
        const header = document.getElementById('trackHeaderMessage');
        const bar = document.getElementById('trackBar');
        
        // YOUR CUSTOM STATUS MESSAGES
        if(data.status === "Processing") {
          header.innerText = "Your document is being processed.";
          bar.style.width = "40%";
        } else if(data.status === "Ready for Pickup") {
          header.innerText = "Your document is ready for pick-up at the Guidance Office.";
          bar.style.width = "85%";
        } else if(data.status === "Received") {
          header.innerText = "Transaction Complete. Document has been claimed.";
          bar.style.width = "100%";
        } else {
          header.innerText = "Your document has been received.";
          bar.style.width = "15%";
        }
      } catch (e) { alert("System busy. Please try again."); }
      btn.innerText = "Check Status";
    }

    // ADMIN FUNCTIONS
    async function handleAdminLogin() {
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPass').value;
      const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "login", email, password}) });
      const auth = await res.text();
      if (auth === "authorized") { showSection('admin-panel'); loadAdminData(); } else { alert("Invalid Credentials."); }
    }

    async function loadAdminData() {
      const body = document.getElementById('adminTableBody');
      body.innerHTML = "<tr><td colspan='5' class='p-10 text-center italic text-gray-400'>Syncing with Google Sheets...</td></tr>";
      try {
        const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "loadAll"}) });
        const data = await res.json();
        body.innerHTML = "";
        data.reverse().forEach(row => {
          body.innerHTML += `
            <tr class="border-b hover:bg-emerald-50 transition">
              <td class="p-4 font-mono font-bold text-xs">${row[0]}</td>
              <td class="p-4"><b>${row[2]}</b><br><span class="text-[10px] text-gray-400">${row[3]}</span></td>
              <td class="p-4 text-[10px] font-semibold">${row[4]}</td>
              <td class="p-4 text-center"><span class="px-2 py-1 rounded-full text-[9px] font-bold bg-emerald-100 text-emerald-800 uppercase tracking-tighter">${row[6]}</span></td>
              <td class="p-4 text-center">
                <select onchange="updateStatus('${row[0]}', this.value)" class="text-[10px] border rounded p-1 outline-none bg-white">
                  <option value="">Select</option>
                  <option value="Processing">Processing</option>
                  <option value="Ready for Pickup">Ready for Pickup</option>
                  <option value="Received">Received</option>
                </select>
              </td>
            </tr>`;
        });
      } catch (e) { body.innerHTML = "Sync Error."; }
    }

    async function updateStatus(tid, newStatus) {
      if (!newStatus) return;
      await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "update", trackingId: tid, newStatus}) });
      loadAdminData();
    }
  </script>
</body>
</html>
